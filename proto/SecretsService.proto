
syntax = "proto3";
import "google/protobuf/empty.proto";
package secrets;

message GetSecretGrpcRequest {
  string          name = 1;
  optional string env  = 2;
}

message SecretGrpcModel {
  string name  = 1;
  string value = 2;
  int32  level = 3;
}

message GetTemplatesUsageRequest {
  string name = 1;
}

message GetTemplatesUsageResponse {
  repeated TemplateUsageModel templates = 1;
}

message TemplateUsageModel{
  string env  = 1;
  string name = 2;
  string yaml = 3;
}

message GetSecretsUsageGrpcRequest {
  string          name = 1;
  optional string env  = 2;
}

message GetSecretsUsageResponse{
  repeated SecretUsageModel secrets = 1;
}

message SecretUsageModel {
  string name  = 1;
  string value = 2;
}

message SecretListItem{
  string name              = 1;
  int32  level             = 2;
  string created           = 3;
  string updated           = 4;
  int32  used_by_templates = 5;
  int32  used_by_secrets   = 6;
}

message SaveSecretGrpcRequest{
  SecretGrpcModel model = 1;
  optional string env   = 2;
}

message DeleteSecretGrpcRequest{
  string          name = 1;
  optional string env  = 2;
}

message GetAllSecretsGrpcRequest{
  optional string env = 1;
}

service Secrets {
  rpc Get(GetSecretGrpcRequest) returns (SecretGrpcModel);
  rpc GetAll(GetAllSecretsGrpcRequest) returns (stream SecretListItem);
  rpc Save(SaveSecretGrpcRequest) returns (google.protobuf.Empty);
  rpc Delete(DeleteSecretGrpcRequest) returns (google.protobuf.Empty);

  rpc GetTemplatesUsage(GetTemplatesUsageRequest) returns (GetTemplatesUsageResponse);
  rpc GetSecretsUsage(DeleteSecretGrpcRequest) returns (GetSecretsUsageResponse);
  rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}